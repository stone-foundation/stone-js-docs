import{_ as d}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as u,b as i,e as r,w as s,r as l,o as h,a as e,d as t}from"./app-7vCtLRjQ.js";const g={};function m(k,n){const c=l("Mermaid"),p=l("Tabs");return h(),u("div",null,[n[4]||(n[4]=i('<p>In Stone.js, a <strong>lifecycle hook</strong> is a listener function that is executed at a specific point in the evolution of the internal context. Hooks provide a structured way to observe what happens inside the system without altering its behavior. They are deeply integrated into the Continuum Architecture, where every application act is scoped within a dynamic, dimension-driven context.</p><p>Lifecycle hooks are dimension-scoped: each dimension in the context has its own set of hook points corresponding to its responsibilities. This makes hooks highly predictable and composable. They allow you to instrument and monitor the system at various phases, whether at boot time, per request, or during teardown.</p><p>However, hooks are strictly <strong>observational</strong>. They are not meant to intercept, control, or mutate context data. If you need to transform or intervene in the lifecycle of an intention or response, you must use middleware instead.</p><p>This page focuses specifically on the <strong>initialization hooks</strong>, the hooks triggered during the lifecycle of each <strong>intention</strong> (e.g., request, event, CLI input). These hooks allow you to trace and instrument everything that happens from the moment a request is received to the moment the response is finalized and the ephemeral execution context is destroyed.</p><p>Low-level lifecycle hooks related to <a href="./blueprint#setup-hooks"><strong>setup</strong></a> and <a href="./adapter#integration-hooks"><strong>integration</strong></a> dimensions will be documented separately.</p><h2 id="initialization-hooks" tabindex="-1"><a class="header-anchor" href="#initialization-hooks"><span>Initialization Hooks</span></a></h2><p>The following hooks are executed during the lifecycle of each intention (e.g. HTTP request, CLI call, event trigger). These hooks are scoped to the <strong>ephemeral execution context</strong> and allow you to observe its evolution from creation to teardown.</p>',7)),r(c,{id:"mermaid-21",code:"eJyNkktPwkAUhff8iklNd5BQipsuTKQP2qiJEeKGuCj0AhOHmWamCkr47965lYdsnK5Oz/lm7qP1/T2XvInY3mvWsAEvYt68NOB1WWu8lpqXcwEGk32HMW+pZDPh30QGw3rnda0ruIRYCaWtfVOFt8N+3+scDgff76x0Wa/ZNEHufqZkgfXeUI9Q56Ws8Ogq/QRJZjx71moBxqDJnnhVCdiWGtijUjXlwSzdweKjgYuUggFedz77AFqCuEJCRK6D3yNQWSJBoL3+2BM1CNqG6Z9Qa6UvwoyqQ43bkqsXMLWShoqOMTi+t0BbKre3nSuQV6A3Bb3hsmzwsN0X6/Xu2Mhui1Rsx2jVgIZudUCbaXVIk17RdvcJqeykUjvTyctIjW3HpHLbI6mi4/ts0nzZ78SWSrNSCCZVBQYRxgwmgI2aRqt36G151awj/C+6Sy5EdJPRc0GOnMnYnQzc0YE7GjqjiTOZOpOZMzl2JnNnsviH/AGwtErQ"}),n[5]||(n[5]=i('<p>Below is the full list of per-intent lifecycle hooks provided by the Initialization Dimension.</p><table><thead><tr><th>Hook Name</th><th>When It Runs</th><th>Typical Use Cases</th></tr></thead><tbody><tr><td><code>onInit</code></td><td>When the execution context is created</td><td>Assign trace IDs, inject request-specific services, log start</td></tr><tr><td><code>onHandlingEvent</code></td><td>When the <code>IncomingEvent</code> is passed to the kernel</td><td>Track when the domain is about to be executed</td></tr><tr><td><code>onProcessingKernelMiddleware</code></td><td>Before each kernel middleware runs</td><td>Log middleware order, start timing, setup middleware-specific context</td></tr><tr><td><code>onKernelMiddlewareProcessed</code></td><td>After each kernel middleware completes</td><td>Track execution time, collect metrics, debug effects</td></tr><tr><td><code>onExecutingEventHandler</code></td><td>Just before the event handler runs</td><td>Attach timing markers, wrap handler in observability logic</td></tr><tr><td><code>onExecutingErrorHandler</code></td><td>If the event handler throws an error</td><td>Log and report exceptions, trigger alerts</td></tr><tr><td><code>onPreparingResponse</code></td><td>Before preparing the internal response</td><td>Normalize output, enrich response metadata</td></tr><tr><td><code>onResponsePrepared</code></td><td>After the internal response is finalized</td><td>Validate structure, inject post-processing metrics</td></tr><tr><td><code>onEventHandled</code></td><td>After the domain logic is complete</td><td>Log successful execution, audit events</td></tr><tr><td><code>onTerminate</code></td><td>When the request lifecycle ends</td><td>Cleanup, release resources, flush async tasks</td></tr></tbody></table><h2 id="hook-listener-registration" tabindex="-1"><a class="header-anchor" href="#hook-listener-registration"><span>Hook Listener Registration</span></a></h2><p>In Stone.js, hook listeners can be registered in two ways:</p><ul><li><strong>Declaratively</strong>, using the <code>@Hook()</code> decorator on a method</li><li><strong>Imperatively</strong>, using the <code>defineBlueprintConfig()</code> utility</li></ul><p>Both approaches allow you to attach logic to any hook point in the system. However, the way hook listeners are resolved and executed reflects the architecture&#39;s introspective and flexible nature.</p>',6)),r(p,{data:[{id:"Declarative"},{id:"Imperative"}],active:0,"tab-id":"declarative-imperative"},{title0:s(({value:o,isActive:a})=>n[0]||(n[0]=[t("Declarative")])),title1:s(({value:o,isActive:a})=>n[1]||(n[1]=[t("Imperative")])),tab0:s(({value:o,isActive:a})=>n[2]||(n[2]=[e("h3",{id:"declarative-registration",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#declarative-registration"},[e("span",null,"Declarative Registration")])],-1),e("p",null,[t("You can declare hook listeners by annotating methods with the "),e("code",null,"@Hook('<hookName>')"),t(" decorator. This is the most common and readable way to bind custom behavior to lifecycle stages.")],-1),e("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[e("pre",null,[e("code",{class:"language-typescript"},[e("span",{class:"line"},[e("span",{class:"token keyword"},"import"),t(),e("span",{class:"token punctuation"},"{"),t(" Hook "),e("span",{class:"token punctuation"},"}"),t(),e("span",{class:"token keyword"},"from"),t(),e("span",{class:"token string"},"'@stone-js/core'"),e("span",{class:"token punctuation"},";")]),t(`
`),e("span",{class:"line"}),t(`
`),e("span",{class:"line"},[e("span",{class:"token keyword"},"export"),t(),e("span",{class:"token keyword"},"class"),t(),e("span",{class:"token class-name"},"LifecycleLogger"),t(),e("span",{class:"token punctuation"},"{")]),t(`
`),e("span",{class:"line"},[t("  "),e("span",{class:"token decorator"},[e("span",{class:"token at operator"},"@"),e("span",{class:"token function"},"Hook")]),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'onInit'"),e("span",{class:"token punctuation"},")")]),t(`
`),e("span",{class:"line"},[t("  "),e("span",{class:"token function"},"logInit"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),t(),e("span",{class:"token punctuation"},"{")]),t(`
`),e("span",{class:"line"},[t("    "),e("span",{class:"token builtin"},"console"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"log"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'Execution context initialized.'"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";")]),t(`
`),e("span",{class:"line"},[t("  "),e("span",{class:"token punctuation"},"}")]),t(`
`),e("span",{class:"line"}),t(`
`),e("span",{class:"line"},[t("  "),e("span",{class:"token decorator"},[e("span",{class:"token at operator"},"@"),e("span",{class:"token function"},"Hook")]),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'onTerminate'"),e("span",{class:"token punctuation"},")")]),t(`
`),e("span",{class:"line"},[t("  "),e("span",{class:"token function"},"cleanup"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},"{"),t(" event "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},")"),t(),e("span",{class:"token punctuation"},"{")]),t(`
`),e("span",{class:"line"},[t("    "),e("span",{class:"token builtin"},"console"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"log"),e("span",{class:"token punctuation"},"("),e("span",{class:"token template-string"},[e("span",{class:"token template-punctuation string"},"`"),e("span",{class:"token string"},"Event "),e("span",{class:"token interpolation"},[e("span",{class:"token interpolation-punctuation punctuation"},"${"),t("event"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"fingerprint"),e("span",{class:"token punctuation"},"("),e("span",{class:"token boolean"},"true"),e("span",{class:"token punctuation"},")"),e("span",{class:"token interpolation-punctuation punctuation"},"}")]),e("span",{class:"token string"}," ended"),e("span",{class:"token template-punctuation string"},"`")]),e("span",{class:"token punctuation"},")")]),t(`
`),e("span",{class:"line"},[t("  "),e("span",{class:"token punctuation"},"}")]),t(`
`),e("span",{class:"line"},[e("span",{class:"token punctuation"},"}")]),t(`
`),e("span",{class:"line"})])]),e("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"})])],-1),e("p",null,[e("strong",null,"Where to declare hooks:")],-1),e("ul",null,[e("li",null,[t("In the "),e("strong",null,"application entrypoint class")]),e("li",null,[t("In a "),e("strong",null,"ServiceProvider"),t(" (we’ll see this in a later section)")]),e("li",null,[t("In "),e("strong",null,"any other class"),t(", but note the following:")])],-1),e("p",null,[t("Hook-decorated methods are "),e("strong",null,"not tied to the class instance"),t(". They are resolved "),e("strong",null,"by reflection"),t(", and may be invoked even if the class is never instantiated. Avoid using "),e("code",null,"this"),t(" or relying on instance state.")],-1),e("p",null,"This ensures that hooks remain introspectable, context-agnostic, and safe to execute in isolated scopes.",-1)])),tab1:s(({value:o,isActive:a})=>n[3]||(n[3]=[e("h3",{id:"imperative-registration",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#imperative-registration"},[e("span",null,"Imperative Registration")])],-1),e("p",null,"Hooks can also be registered manually in the blueprint definition. This approach is useful when you want full control over listener setup, for example, when registering hooks conditionally, injecting them dynamically, or composing from external libraries.",-1),e("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[e("pre",null,[e("code",{class:"language-typescript"},[e("span",{class:"line"},[e("span",{class:"token keyword"},"import"),t(),e("span",{class:"token punctuation"},"{"),t(" defineBlueprintConfig "),e("span",{class:"token punctuation"},"}"),t(),e("span",{class:"token keyword"},"from"),t(),e("span",{class:"token string"},"'@stone-js/core'")]),t(`
`),e("span",{class:"line"}),t(`
`),e("span",{class:"line"},[e("span",{class:"token keyword"},"const"),t(),e("span",{class:"token function-variable function"},"logInit"),t(),e("span",{class:"token operator"},"="),t(),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),t(),e("span",{class:"token operator"},"=>"),t(),e("span",{class:"token builtin"},"console"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"log"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'Init triggered'"),e("span",{class:"token punctuation"},")")]),t(`
`),e("span",{class:"line"},[e("span",{class:"token keyword"},"const"),t(),e("span",{class:"token function-variable function"},"logTerminate"),t(),e("span",{class:"token operator"},"="),t(),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},"{"),t(" event "),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},")"),t(),e("span",{class:"token operator"},"=>"),t(),e("span",{class:"token punctuation"},"{")]),t(`
`),e("span",{class:"line"},[t("  "),e("span",{class:"token builtin"},"console"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"log"),e("span",{class:"token punctuation"},"("),e("span",{class:"token template-string"},[e("span",{class:"token template-punctuation string"},"`"),e("span",{class:"token string"},"Event "),e("span",{class:"token interpolation"},[e("span",{class:"token interpolation-punctuation punctuation"},"${"),t("event"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"fingerprint"),e("span",{class:"token punctuation"},"("),e("span",{class:"token boolean"},"true"),e("span",{class:"token punctuation"},")"),e("span",{class:"token interpolation-punctuation punctuation"},"}")]),e("span",{class:"token string"}," ended"),e("span",{class:"token template-punctuation string"},"`")]),e("span",{class:"token punctuation"},")")]),t(`
`),e("span",{class:"line"},[e("span",{class:"token punctuation"},"}")]),t(`
`),e("span",{class:"line"}),t(`
`),e("span",{class:"line"},[e("span",{class:"token keyword"},"export"),t(),e("span",{class:"token keyword"},"const"),t(" mainBlueprint "),e("span",{class:"token operator"},"="),t(),e("span",{class:"token function"},"defineBlueprintConfig"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},"("),t("blueprint"),e("span",{class:"token punctuation"},")"),t(),e("span",{class:"token operator"},"=>"),t(),e("span",{class:"token punctuation"},"{")]),t(`
`),e("span",{class:"line"},[t("  blueprint"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"add"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'stone.lifecycleHooks.onInit'"),e("span",{class:"token punctuation"},","),t(),e("span",{class:"token punctuation"},"["),t("logInit"),e("span",{class:"token punctuation"},"]"),e("span",{class:"token punctuation"},")")]),t(`
`),e("span",{class:"line"},[t("  blueprint"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"add"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'stone.lifecycleHooks.onTerminate'"),e("span",{class:"token punctuation"},","),t(),e("span",{class:"token punctuation"},"["),t("logTerminate"),e("span",{class:"token punctuation"},"]"),e("span",{class:"token punctuation"},")")]),t(`
`),e("span",{class:"line"},[e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},")")]),t(`
`),e("span",{class:"line"})])]),e("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"})])],-1),e("p",null,[t("This method attaches the listener directly to the context lifecycle under the "),e("code",null,"stone.lifecycleHooks.<hookName>"),t(" namespace.")],-1),e("p",null,[e("strong",null,"Use this approach when:")],-1),e("ul",null,[e("li",null,[t("You need to register hooks "),e("strong",null,"outside class structures")]),e("li",null,[t("You want to "),e("strong",null,"compose hooks dynamically")]),e("li",null,[t("You are building "),e("strong",null,"framework extensions or plugins")])],-1)])),_:1}),n[6]||(n[6]=i('<h2 id="hook-vs-middleware" tabindex="-1"><a class="header-anchor" href="#hook-vs-middleware"><span>Hook vs. Middleware</span></a></h2><p>In Stone.js, both <strong>hooks</strong> and <a href="./middleware"><strong>middleware</strong></a> allow you to react to different stages of the context lifecycle, but they serve <strong>fundamentally different purposes</strong>.</p><p>Understanding this distinction is key to writing clear, maintainable, and continuum-aligned systems.</p><h3 id="hooks-observers" tabindex="-1"><a class="header-anchor" href="#hooks-observers"><span>Hooks: Observers</span></a></h3><p>Hooks are passive. They are triggered automatically by the framework at well-defined execution points. They cannot interrupt the flow, short-circuit execution, or return alternative results. They exist <strong>outside the pipeline</strong>, and their purpose is to <strong>observe and instrument</strong> the context.</p><ul><li>Listen to internal events</li><li>Measure performance</li><li>Collect analytics</li><li>Log execution</li><li>Extend features in a modular way</li><li>React to success/failure states</li></ul><p>Hooks do not mutate the <a href="../essentials/incoming-event"><code>IncomingEvent</code></a>, the <a href="../essentials/outgoing-response"><code>OutgoingResponse</code></a>, or the execution pipeline. They are safe, side-effect-free tools for <strong>observability and diagnostics</strong>.</p><h3 id="middleware-participants" tabindex="-1"><a class="header-anchor" href="#middleware-participants"><span>Middleware: Participants</span></a></h3><p>Middleware are active. They are part of the execution pipeline and can:</p><ul><li>Short-circuit the flow</li><li>Modify the <a href="../essentials/incoming-event"><code>IncomingEvent</code></a> or <a href="../essentials/outgoing-response"><code>OutgoingResponse</code></a></li><li>Apply validation, authentication, or business-specific rules</li><li>Catch and transform errors</li><li>Inject data into the context</li></ul><p>Middleware lives <strong>inside the dimensions</strong>, especially in the <a href="./blueprint"><strong>Setup</strong></a>, <a href="./adapter"><strong>Integration</strong></a>, and <strong>Initialization</strong> dimensions, and is responsible for shaping the behavior of the context.</p><p>They define <strong>how</strong> intentions are interpreted, and <strong>what</strong> happens in response.</p><h3 id="comparison-table" tabindex="-1"><a class="header-anchor" href="#comparison-table"><span>Comparison Table</span></a></h3><table><thead><tr><th>Feature</th><th>Hook</th><th>Middleware</th></tr></thead><tbody><tr><td>Role</td><td>Observer</td><td>Participant</td></tr><tr><td>Execution scope</td><td>Outside the pipeline</td><td>Inside the pipeline</td></tr><tr><td>Can mutate context?</td><td>No</td><td>Yes</td></tr><tr><td>Can short-circuit flow?</td><td>No</td><td>Yes</td></tr><tr><td>Access to <code>next()</code></td><td>No</td><td>Yes</td></tr><tr><td>Purpose</td><td>Monitoring, logging, metrics</td><td>Behavior, transformation, control</td></tr><tr><td>Typical usage</td><td>Tracing, audit logs, cleanup</td><td>Auth, validation, response shaping</td></tr></tbody></table><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><p>Lifecycle hooks in Stone.js provide a structured, dimension-aware way to <strong>observe</strong> the internal evolution of the context, from system startup to per-intent execution and teardown.</p><p>They are:</p><ul><li><strong>Dimension-scoped</strong>: Each hook is bound to a specific phase of the continuum</li><li><strong>Passive</strong>: Hooks cannot modify or interrupt the flow, they listen, they don’t act</li><li><strong>Safe and isolated</strong>: Hook execution is side-effect-tolerant and does not depend on class instantiation</li><li><strong>Crucial for instrumentation</strong>: Ideal for logging, tracing, performance measurement, debugging, and system introspection</li></ul><p>In this documentation, we focused specifically on the <strong>Initialization Dimension</strong>, where per-intent hooks are triggered for each ephemeral execution context.</p><p>Hooks are registered using:</p><ul><li><code>@Hook()</code> decorators for declarative class-based listeners</li><li><code>defineBlueprintConfig</code> for flexible, imperative registration</li></ul><p>And most importantly:</p><blockquote><p>Use <strong>hooks</strong> when you want to observe what’s happening.<br> Use <strong>middleware</strong> when you want to control what happens.</p></blockquote><p>If your code <strong>returns</strong>, <strong>transforms</strong>, or <strong>decides</strong>, it’s middleware.<br> If your code just <strong>records</strong>, <strong>measures</strong>, or <strong>responds after the fact</strong>, it’s a hook.</p><p>To go deeper:</p><ul><li>Explore <a href="./blueprint#setup-hooks"><strong>Setup Hooks</strong></a> to instrument blueprint construction</li><li>Explore <a href="./adapter#integration-hooks"><strong>Integration Hooks</strong></a> to track adapter-level behavior</li><li>See the <a href="./middleware"><strong>Middleware</strong></a> documentation to learn how to intercept and control flow across dimensions</li></ul><p>The more you align your instrumentation strategy with the Continuum, the more modular, observable, and resilient your application will become.</p>',27))])}const v=d(g,[["render",m]]),b=JSON.parse('{"path":"/docs/architecture/lifecycle.html","title":"Lifecycle","lang":"en-US","frontmatter":{"title":"Lifecycle","description":"In Stone.js, a lifecycle hook is a listener function that is executed at a specific point in the evolution of the internal context. Hooks provide a structured way to observe wha...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Lifecycle\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-06-07T20:31:21.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr. Stone\\"}]}"],["meta",{"property":"og:url","content":"https://stonejs.com/docs/architecture/lifecycle.html"}],["meta",{"property":"og:site_name","content":"Stone.js"}],["meta",{"property":"og:title","content":"Lifecycle"}],["meta",{"property":"og:description","content":"In Stone.js, a lifecycle hook is a listener function that is executed at a specific point in the evolution of the internal context. Hooks provide a structured way to observe wha..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-06-07T20:31:21.000Z"}],["meta",{"property":"article:modified_time","content":"2025-06-07T20:31:21.000Z"}]]},"git":{"createdTime":1749328281000,"updatedTime":1749328281000,"contributors":[{"name":"Mr Stone","username":"","email":"pierre.evens16@gmail.com","commits":1}]},"readingTime":{"minutes":4.58,"words":1374},"filePathRelative":"docs/architecture/lifecycle.md","autoDesc":true}');export{v as comp,b as data};
