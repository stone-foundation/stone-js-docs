import{_ as d}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as u,b as l,e as i,a as n,w as a,d as s,r,o as k}from"./app-C80Pz9_H.js";const m={};function h(v,e){const c=r("Mermaid"),p=r("Tabs");return k(),u("div",null,[e[28]||(e[28]=l('<p>Adapters in Stone.js are the official bridge between your application and the outside world. Whether you’re running in a Node.js server, a FaaS like AWS Lambda, a browser, or a CLI, adapters make it all feel the same from your application’s perspective.</p><h3 id="what-is-an-adapter" tabindex="-1"><a class="header-anchor" href="#what-is-an-adapter"><span>What is an adapter?</span></a></h3><p>An adapter is a module that translates an external request into a normalized internal event (<code>IncomingEvent</code>) and transforms your system&#39;s response (<code>OutgoingResponse</code>) back into a format that the underlying platform understands.</p><p>Think of it as a platform-specific translator. It wraps the unpredictable, environment-specific inputs and outputs into the standardized flow that your Stone.js system expects.</p><h3 id="why-use-adapters" tabindex="-1"><a class="header-anchor" href="#why-use-adapters"><span>Why use adapters?</span></a></h3><p>Adapters let you write one system that runs everywhere. They abstract away the platform-specific protocols, runtimes, and APIs, giving you:</p><ul><li><strong>Runtime independence</strong>: The same logic works in the browser, on a server, or in a FaaS.</li><li><strong>Seamless event handling</strong>: Every platform ends up producing the same kind of internal event.</li><li><strong>Unified development model</strong>: You don&#39;t need to worry about how requests arrive, just what they mean.</li></ul><p>Adapters are central to Stone.js&#39;s mission: <strong>build once, deploy anywhere</strong>.</p><h3 id="where-adapters-fit-in-the-continuum-architecture" tabindex="-1"><a class="header-anchor" href="#where-adapters-fit-in-the-continuum-architecture"><span>Where adapters fit in the Continuum Architecture</span></a></h3><p>In the Continuum Architecture, adapters belong to the <strong>Integration Dimension</strong>.</p>',10)),i(c,{id:"mermaid-44",code:"eJyNjzFPwzAQhff8iidX3mKpiLJkqJQEkJCYqMRSdXDJpbFw7cq21ECU/87FLDDBLXf37runOykn40yqMIk00JlEBXHUkUSJb+FVB6OPliJPpgIQvXdpZz4zebO5jKJcVGsctd76sMir7vZus16LYp5nKYve+uvboEPC8wuzQL1/GBMFpy1adqMxHaCU2qLZP3F7CjoZ73BvzuTiUinUnb7wSjxkg4bxLdpM/7IppMQuffA1J/Q+QFsL5zuKeS3yhFBzDv6d1NV0aaj4hbI31larxxw/yObfZPsH+QU3DHB1"}),e[29]||(e[29]=l(`<p>This is the layer that mediates between:</p><ul><li>The <strong>external context</strong> (HTTP server, CLI input, browser events, FaaS triggers...)</li><li>And the <strong>internal system</strong> (your application logic and domain)</li></ul><p>Adapters <strong>transform context</strong>, letting your business logic ignore where requests come from, and still respond correctly.</p><p>They&#39;re the gatekeepers of your application. Every event starts with them.</p><h3 id="how-adapters-work-at-runtime" tabindex="-1"><a class="header-anchor" href="#how-adapters-work-at-runtime"><span>How adapters work at runtime</span></a></h3><p>At runtime and after the Setup Phase, an adapter is the first thing executed. It:</p><ol><li>Receives a platform-native request (like an HTTP request, console args, or FaaS event).</li><li>Uses an <strong>input builder</strong> to create a standardized <code>IncomingEvent</code>.</li><li>Passes the event to the system’s kernel for processing.</li><li>Receives the <code>OutgoingResponse</code>.</li><li>Uses an <strong>output builder</strong> to convert it back into a format the platform understands.</li></ol><p>The entire journey, from real-world input to platform-specific output, is encapsulated within the adapter.</p><h2 id="using-adapters" tabindex="-1"><a class="header-anchor" href="#using-adapters"><span>Using Adapters</span></a></h2><p>Stone.js adapters are the entry points into your system. They let you connect your code to any execution context, Node.js, FaaS, the browser, or the CLI, without changing your internal logic.</p><p>This section explains how to <strong>install</strong>, <strong>activate</strong>, <strong>configure</strong>, and <strong>orchestrate</strong> multiple adapters, using both the declarative and imperative APIs. We&#39;ll use the Node.js HTTP adapter in examples, but the same concepts apply to any other adapter.</p><h3 id="registering-adapters" tabindex="-1"><a class="header-anchor" href="#registering-adapters"><span>Registering Adapters</span></a></h3><p>Before using any adapter, you must install and register it.</p><h4 id="install" tabindex="-1"><a class="header-anchor" href="#install"><span>Install</span></a></h4><p>Stone.js is framework-agnostic by design, no adapter is bundled by default. You choose what to install:</p><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>The Node HTTP adapter is installed and activated by default when you create a new Stone.js project using the CLI.</p></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">npm</span> <span class="token function">install</span> @stone-js/node-http-adapter</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Once installed, you&#39;re ready to activate it in your system.</p><h4 id="activate" tabindex="-1"><a class="header-anchor" href="#activate"><span>Activate</span></a></h4><p>You can register adapters using either the <strong>declarative</strong> or <strong>imperative</strong> API.</p>`,20)),i(p,{data:[{id:"Declarative"},{id:"Imperative"}],active:0,"tab-id":"declarative-imperative"},{title0:a(({value:t,isActive:o})=>e[0]||(e[0]=[s("Declarative")])),title1:a(({value:t,isActive:o})=>e[1]||(e[1]=[s("Imperative")])),tab0:a(({value:t,isActive:o})=>e[2]||(e[2]=[n("h5",{id:"declarative",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#declarative"},[n("span",null,"Declarative")])],-1),n("p",null,[s("Use the adapter’s decorator (e.g., "),n("code",null,"@NodeHttp()"),s(") on your main entry point class:")],-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" NodeHttp "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/node-http-adapter'")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" IncomingEvent"),n("span",{class:"token punctuation"},","),s(" IEventHandler"),n("span",{class:"token punctuation"},","),s(" StoneApp "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/core'")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"NodeHttp")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"StoneApp")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Application"),s(),n("span",{class:"token keyword"},"implements"),s(),n("span",{class:"token class-name"},[s("IEventHandler"),n("span",{class:"token operator"},"<"),s("IncomingEvent"),n("span",{class:"token operator"},">")]),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token function"},"handle"),n("span",{class:"token punctuation"},"("),s("event"),n("span",{class:"token operator"},":"),s(" IncomingEvent"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"{"),s(" message"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'Hello world!'"),s(),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,"This automatically binds the adapter to your application in a platform-aware way.",-1)])),tab1:a(({value:t,isActive:o})=>e[3]||(e[3]=[n("h5",{id:"imperative",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#imperative"},[n("span",null,"Imperative")])],-1),n("p",null,[s("Register the adapter blueprint using "),n("code",null,"defineBlueprintConfig"),s(":")],-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" defineBlueprintConfig"),n("span",{class:"token punctuation"},","),s(" IncomingEvent "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/core'")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" nodeHttpAdapterBlueprint "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/node-http-adapter'")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"Application"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("event"),n("span",{class:"token operator"},":"),s(" IncomingEvent"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" message"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'Hello world!'"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(" mainBlueprint "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"defineBlueprintConfig"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("blueprint"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},"  blueprint"),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("nodeHttpAdapterBlueprint"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'stone.kernel.eventHandler'"),n("span",{class:"token punctuation"},","),s(" Application"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,"This provides full programmatic control over registration.",-1)])),_:1}),e[30]||(e[30]=l(`<h3 id="built-in-adapters" tabindex="-1"><a class="header-anchor" href="#built-in-adapters"><span>Built-in Adapters</span></a></h3><p>Stone.js comes with several built-in adapters, each tailored for a specific environment. You can also create your own custom adapters if needed.</p><h4 id="installation" tabindex="-1"><a class="header-anchor" href="#installation"><span>Installation</span></a></h4><p>In this table, you can find the available adapters and their installation commands.</p><table><thead><tr><th>Adapter</th><th>Description</th><th>Install Command</th></tr></thead><tbody><tr><td>Node HTTP</td><td>Runs on a Node.js HTTP server</td><td><code>npm install @stone-js/node-http-adapter</code></td></tr><tr><td>Node CLI</td><td>For command-line applications</td><td><code>npm install @stone-js/node-cli-adapter</code></td></tr><tr><td>Browser</td><td>Runs in SPA/SSR client-side apps</td><td><code>npm install @stone-js/browser-adapter</code></td></tr><tr><td>AWS Lambda</td><td>Runs in a generic AWS Lambda function</td><td><code>npm install @stone-js/aws-lambda-adapter</code></td></tr><tr><td>AWS Lambda HTTP</td><td>Runs in HTTP-based AWS Lambda function</td><td><code>npm install @stone-js/aws-lambda-http-adapter</code></td></tr></tbody></table><h4 id="registration" tabindex="-1"><a class="header-anchor" href="#registration"><span>Registration</span></a></h4><p>In this table, you can find their registration methods.</p><table><thead><tr><th>Adapter</th><th>Declarative Decorator</th><th>Imperative Blueprint</th></tr></thead><tbody><tr><td>Node HTTP</td><td><code>NodeHttp</code></td><td><code>nodeHttpAdapterBlueprint</code></td></tr><tr><td>Node CLI</td><td><code>NodeConsole</code></td><td><code>nodeConsoleAdapterBlueprint</code></td></tr><tr><td>Browser</td><td><code>Browser</code></td><td><code>browserAdapterBlueprint</code></td></tr><tr><td>AWS Lambda</td><td><code>AwsLambda</code></td><td><code>awsLambdaAdapterBlueprint</code></td></tr><tr><td>AWS Lambda HTTP</td><td><code>AwsLambdaHttp</code></td><td><code>awsLambdaHttpAdapterBlueprint</code></td></tr></tbody></table><h3 id="multiple-adapters" tabindex="-1"><a class="header-anchor" href="#multiple-adapters"><span>Multiple Adapters</span></a></h3><p>Stone.js lets you register multiple adapters at once. This allows your app to run in different environments (e.g., Node + Browser) from a single system definition.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">npm</span> <span class="token function">install</span> @stone-js/node-http-adapter @stone-js/browser-adapter</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Then register them either declaratively or imperatively, they can coexist without conflict.</p>`,12)),i(p,{data:[{id:"Declarative"},{id:"Imperative"}],active:0,"tab-id":"declarative-imperative"},{title0:a(({value:t,isActive:o})=>e[4]||(e[4]=[s("Declarative")])),title1:a(({value:t,isActive:o})=>e[5]||(e[5]=[s("Imperative")])),tab0:a(({value:t,isActive:o})=>e[6]||(e[6]=[n("h5",{id:"declarative-1",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#declarative-1"},[n("span",null,"Declarative")])],-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" Browser "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/browser-adapter'")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" NodeHttp "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/node-http-adapter'")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" IncomingEvent"),n("span",{class:"token punctuation"},","),s(" IEventHandler"),n("span",{class:"token punctuation"},","),s(" StoneApp "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/core'")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"Browser")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"NodeHttp")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"StoneApp")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Application"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1)])),tab1:a(({value:t,isActive:o})=>e[7]||(e[7]=[n("h5",{id:"imperative-1",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#imperative-1"},[n("span",null,"Imperative")])],-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" browserAdapterBlueprint "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/browser-adapter'")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" defineBlueprintConfig"),n("span",{class:"token punctuation"},","),s(" IncomingEvent "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/core'")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" nodeHttpAdapterBlueprint "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/node-http-adapter'")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(" mainBlueprint "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"defineBlueprintConfig"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("blueprint"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},"  blueprint"),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("browserAdapterBlueprint"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("nodeHttpAdapterBlueprint"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1)])),_:1}),e[31]||(e[31]=l('<h3 id="implicit-activation-contextual-decoherence" tabindex="-1"><a class="header-anchor" href="#implicit-activation-contextual-decoherence"><span>Implicit Activation (Contextual Decoherence)</span></a></h3><p>When multiple adapters are installed, Stone.js keeps them in a <strong>superposition</strong> state. At runtime, it infers the appropriate adapter based on the external context, this is called <strong>contextual decoherence</strong> in the Continuum.</p><p>You don’t need to decide; the system does it for you. This makes Stone.js feel magically universal.</p><h3 id="explicit-activation" tabindex="-1"><a class="header-anchor" href="#explicit-activation"><span>Explicit Activation</span></a></h3><p>For full control, you can explicitly define which adapter should be used at runtime.</p>',5)),i(p,{data:[{id:"Declarative"},{id:"Imperative"}],active:0,"tab-id":"declarative-imperative"},{title0:a(({value:t,isActive:o})=>e[8]||(e[8]=[s("Declarative")])),title1:a(({value:t,isActive:o})=>e[9]||(e[9]=[s("Imperative")])),tab0:a(({value:t,isActive:o})=>e[10]||(e[10]=[n("h4",{id:"declarative-control",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#declarative-control"},[n("span",null,"Declarative Control")])],-1),n("p",null,"You can use options directly in the adapter decorators:",-1),n("ul",null,[n("li",null,[n("code",null,"current"),s(": Forces this adapter to be the one used at runtime")]),n("li",null,[n("code",null,"default"),s(": Marks this adapter as the fallback if none are explicitly selected")]),n("li",null,[n("code",null,"alias"),s(": Names this adapter so you can refer to it later")])],-1),n("p",null,"Example:",-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" Browser "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/browser-adapter'")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" NodeHttp "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/node-http-adapter'")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" StoneApp"),n("span",{class:"token punctuation"},","),s(" IncomingEvent"),n("span",{class:"token punctuation"},","),s(" IEventHandler "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/core'")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"StoneApp")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"NodeHttp")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" alias"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'MyNodeAdapter'"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"Browser")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" alias"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'MyBrowserAdapter'"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Application"),s(),n("span",{class:"token keyword"},"implements"),s(),n("span",{class:"token class-name"},[s("IEventHandler"),n("span",{class:"token operator"},"<"),s("IncomingEvent"),n("span",{class:"token operator"},">")]),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token function"},"handle"),n("span",{class:"token punctuation"},"("),s("event"),n("span",{class:"token operator"},":"),s(" IncomingEvent"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"{"),s(" message"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'Hello world!'"),s(),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,"You can then resolve the current adapter based on runtime conditions using configuration:",-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" Configuration"),n("span",{class:"token punctuation"},","),s(" IConfiguration"),n("span",{class:"token punctuation"},","),s(" IBlueprint "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/core'")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"Configuration")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"MyConfig"),s(),n("span",{class:"token keyword"},"implements"),s(),n("span",{class:"token class-name"},"IConfiguration"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token function"},"configure"),n("span",{class:"token punctuation"},"("),s("blueprint"),n("span",{class:"token operator"},":"),s(" IBlueprint"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    blueprint"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token string"},"'stone.adapter.alias'"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token keyword"},"typeof"),s(" window "),n("span",{class:"token operator"},"!=="),s(),n("span",{class:"token string"},"'undefined'"),s(),n("span",{class:"token operator"},"?"),s(),n("span",{class:"token string"},"'MyBrowserAdapter'"),s(),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'MyNodeAdapter'")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,[s("Stone.js will use the "),n("code",null,"MyBrowserAdapter"),s("'s adapter if running in a browser, or "),n("code",null,"MyNodeAdapter"),s("'s adapter otherwise.")],-1)])),tab1:a(({value:t,isActive:o})=>e[11]||(e[11]=[n("h4",{id:"imperative-control",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#imperative-control"},[n("span",null,"Imperative Control")])],-1),n("p",null,[s("You can also use pure logic in your "),n("code",null,"defineBlueprintConfig"),s(" to select the adapter based on platform:")],-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" browserAdapterBlueprint "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/browser-adapter'")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" defineBlueprintConfig"),n("span",{class:"token punctuation"},","),s(" IncomingEvent "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/core'")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" nodeHttpAdapterBlueprint "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/node-http-adapter'")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"Application"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("event"),n("span",{class:"token operator"},":"),s(" IncomingEvent"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" message"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'Hello world!'"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(" mainBlueprint "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"defineBlueprintConfig"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("blueprint"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},"  blueprint"),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'stone.kernel.eventHandler'"),n("span",{class:"token punctuation"},","),s(" Application"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token keyword"},"typeof"),s(" window "),n("span",{class:"token operator"},"!=="),s(),n("span",{class:"token string"},"'undefined'")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token operator"},"?"),s(" browserAdapterBlueprint")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token operator"},":"),s(" nodeHttpAdapterBlueprint")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,[s("Stone.js will use the "),n("code",null,"browserAdapterBlueprint"),s(" if running in a browser, or "),n("code",null,"nodeHttpAdapterBlueprint"),s(" otherwise.")],-1)])),_:1}),e[32]||(e[32]=n("h3",{id:"configure-adapters",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#configure-adapters"},[n("span",null,"Configure Adapters")])],-1)),e[33]||(e[33]=n("p",null,[s("Because the current adapter is resolved dynamically at runtime, you also need to configure it at runtime using the "),n("a",{href:"./blueprint#dynamic-configuration"},"Blueprint Middleware"),s(".")],-1)),i(p,{data:[{id:"Declarative"},{id:"Imperative"}],active:0,"tab-id":"declarative-imperative"},{title0:a(({value:t,isActive:o})=>e[12]||(e[12]=[s("Declarative")])),title1:a(({value:t,isActive:o})=>e[13]||(e[13]=[s("Imperative")])),tab0:a(({value:t,isActive:o})=>e[14]||(e[14]=[n("h4",{id:"declarative-setup",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#declarative-setup"},[n("span",null,"Declarative Setup")])],-1),n("p",null,[s("Use the "),n("code",null,"@ConfigMiddleware()"),s(" decorator to define a Blueprint Middleware:")],-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" MyMiddleware "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./my-middleware'")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  ConfigMiddleware"),n("span",{class:"token punctuation"},","),s(" BlueprintContext"),n("span",{class:"token punctuation"},","),s(" NextMiddleware")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/core'")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"ConfigMiddleware")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"MySetupMiddleware"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token function"},"handle"),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token operator"},":"),s(" BlueprintContext"),n("span",{class:"token punctuation"},","),s(" next"),n("span",{class:"token operator"},":"),s(" NextMiddleware"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"const"),s(" blueprint "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("blueprint"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'stone.adapter.platform'"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},"'browser'"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("      blueprint"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token string"},"'stone.adapter.middleware'"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"{"),s(" module"),n("span",{class:"token operator"},":"),s(" MyMiddleware"),n("span",{class:"token punctuation"},","),s(" isClass"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},"]")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"return"),s(" blueprint")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1)])),tab1:a(({value:t,isActive:o})=>e[15]||(e[15]=[n("h4",{id:"imperative-setup",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#imperative-setup"},[n("span",null,"Imperative Setup")])],-1),n("p",null,"Define the setup middleware as a function:",-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" MyMiddleware "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./my-middleware'")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  defineBlueprintConfig"),n("span",{class:"token punctuation"},","),s(" BlueprintContext"),n("span",{class:"token punctuation"},","),s(" NextMiddleware")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/core'")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"MySetupMiddleware"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("  context"),n("span",{class:"token operator"},":"),s(" BlueprintContext"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  next"),n("span",{class:"token operator"},":"),s(" NextMiddleware")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"const"),s(" blueprint "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("blueprint"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'stone.adapter.platform'"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},"'browser'"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    blueprint"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token string"},"'stone.adapter.middleware'"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"{"),s(" module"),n("span",{class:"token operator"},":"),s(" MyMiddleware"),n("span",{class:"token punctuation"},","),s(" isClass"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},"]")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"return"),s(" blueprint")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(" appBlueprint "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"defineBlueprintConfig"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("blueprint"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  blueprint"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'stone.blueprint.middleware'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"["),s("MySetupMiddleware"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1)])),_:1}),e[34]||(e[34]=l(`<p>In this example we first get the <code>Blueprint</code> from <code>next</code> to make sure the current adapter is already inferred. Then we check the <code>stone.adapter.platform</code> property to see if the current adapter is a browser adapter. If it is, we add our custom middleware to the <code>stone.adapter.middleware</code> property.</p><h3 id="built-in-adapter-options" tabindex="-1"><a class="header-anchor" href="#built-in-adapter-options"><span>Built-in Adapter Options</span></a></h3><p>Each adapter exposes custom options to fine-tune its behavior. Here are some examples:</p><table><thead><tr><th>Option</th><th>Description</th><th>Adapter</th><th>Readonly</th></tr></thead><tbody><tr><td><code>middleware</code></td><td>List of middleware modules to be used by the adapter</td><td>All</td><td>No</td></tr><tr><td><code>alias</code></td><td>The name of the adapter, used for resolving the current adapter at runtime</td><td>All</td><td>No</td></tr><tr><td><code>current</code></td><td>Whether this adapter should be used as the current one at runtime</td><td>All</td><td>No</td></tr><tr><td><code>default</code></td><td>Whether this adapter should be used as the default if no other is selected</td><td>All</td><td>No</td></tr><tr><td><code>platform</code></td><td>The platform the adapter is running on (e.g., <code>node_http</code>, <code>browser</code>, <code>aws_lambda_http</code>)</td><td>All</td><td>Yes</td></tr><tr><td><code>variant</code></td><td>The variant of the adapter (e.g., <code>server</code>, <code>browser</code>, <code>console</code>)</td><td>All</td><td>Yes</td></tr><tr><td><code>url</code></td><td>Base URL used to launch the HTTP server</td><td>Node HTTP</td><td>No</td></tr><tr><td><code>isSsl</code></td><td>Whether to use HTTPS</td><td>Node HTTP</td><td>No</td></tr><tr><td><code>server</code></td><td>Node HTTP server options (e.g., port, cert, host)</td><td>Node HTTP</td><td>No</td></tr><tr><td><code>printUrls</code></td><td>If <code>true</code>, prints the final server URL at startup</td><td>Node HTTP</td><td>No</td></tr><tr><td><code>serverMiddleware</code></td><td>Low-level HTTP middleware (like <code>connect</code> or <code>express</code>) before Stone Adapter middleware</td><td>Node HTTP</td><td>No</td></tr><tr><td><code>events</code></td><td>Array of DOM event types to transform into Stone <code>IncomingEvent</code>s</td><td>Browser</td><td>No</td></tr><tr><td><code>commands</code></td><td>List of command definitions as <code>MetaCommandHandler[]</code></td><td>Node CLI</td><td>No</td></tr></tbody></table><h2 id="adapter-middleware" tabindex="-1"><a class="header-anchor" href="#adapter-middleware"><span>Adapter Middleware</span></a></h2><p>Adapter middleware in Stone.js are not general-purpose middlewares. They don’t handle authentication, logging, or cross-cutting concerns. Instead, they serve a very specific purpose: they are <strong>builders</strong> that translate raw external inputs into normalized system events, and convert system responses back into platform-native outputs.</p><p>These middlewares operate at the <strong>adapter level</strong>, and are executed <strong>before</strong> your system logic runs. They allow you to participate in the construction of:</p><ul><li><code>IncomingEvent</code>: the standardized event passed to your system</li><li><code>rawResponse</code>: the platform-native response that is sent back to the external context</li></ul><p>To do this, they expose two builder objects:</p><ul><li><code>incomingEventBuilder</code>: used to assemble the <code>IncomingEvent</code></li><li><code>rawResponseBuilder</code>: used to generate the final platform response from the <code>OutgoingResponse</code></li></ul><p>Adapter middleware are a critical part of the <strong>Integration Dimension</strong>, responsible for transforming raw, unpredictable context into clean, normalized system flow, before your application logic even sees it.</p><h3 id="context-and-builders" tabindex="-1"><a class="header-anchor" href="#context-and-builders"><span>Context and Builders</span></a></h3><p>Each adapter middleware receives an <code>AdapterContext</code>, a structured object that provides access to both the raw platform data and the tools needed to build normalized system events and responses.</p><p>This context varies slightly depending on the adapter (Node.js, Lambda, Browser, etc.), but always follows the same structure:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">AdapterContext</span> <span class="token punctuation">{</span></span>
<span class="line">  rawEvent<span class="token operator">:</span> RawEventType</span>
<span class="line">  rawResponse<span class="token operator">?</span><span class="token operator">:</span> RawResponseType</span>
<span class="line">  executionContext<span class="token operator">:</span> ExecutionContextType</span>
<span class="line">  incomingEvent<span class="token operator">?</span><span class="token operator">:</span> IncomingEventType</span>
<span class="line">  outgoingResponse<span class="token operator">?</span><span class="token operator">:</span> OutgoingResponseType</span>
<span class="line">  incomingEventBuilder<span class="token operator">:</span> IAdapterEventBuilder</span>
<span class="line">  rawResponseBuilder<span class="token operator">:</span> IAdapterEventBuilder</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here’s what each property represents:</p><ul><li><p><strong><code>rawEvent</code></strong><br> The original request or trigger received from the platform. This could be an HTTP request in Node.js, a Lambda event, CLI arguments, or a browser event.<br> → <em>You use this to extract data when building the <code>IncomingEvent</code>.</em></p></li><li><p><strong><code>rawResponse</code></strong> <em>(optional)</em><br> The raw platform-specific response object (e.g., Node.js response stream).<br> → <em>Never modify this directly, always use <code>rawResponseBuilder</code> to shape the response.</em></p></li><li><p><strong><code>executionContext</code></strong><br> A platform-specific object related to the environment in which the adapter is running. For example, this could be the Node HTTP server or AWS Lambda context object.<br> → <em>Used for platform-related metadata if needed.</em></p></li><li><p><strong><code>incomingEvent</code></strong> <em>(optional)</em><br> The normalized <code>IncomingEvent</code> built from the <code>incomingEventBuilder</code>.<br> → <em>Do not mutate this. If you want to affect it, use the builder before calling <code>next()</code>.</em></p></li><li><p><strong><code>outgoingResponse</code></strong> <em>(optional)</em><br> The final <code>OutgoingResponse</code> returned by your system logic after <code>next()</code> has been called.<br> → <em>You can read this to help shape the final output using <code>rawResponseBuilder</code>.</em></p></li><li><p><strong><code>incomingEventBuilder</code></strong><br> A mutable builder object used to construct the <code>IncomingEvent</code>.<br> → <em>Call <code>add()</code> or <code>addIf()</code> to incrementally build the event.</em></p></li><li><p><strong><code>rawResponseBuilder</code></strong><br> A builder for producing the final platform-native response from the system’s <code>OutgoingResponse</code>.<br> → <em>Also uses <code>add()</code> and <code>addIf()</code> to shape the output before returning it to the platform.</em></p></li></ul><div class="hint-container important"><p class="hint-container-title">Important</p><p>Only the builders (<code>incomingEventBuilder</code>, <code>rawResponseBuilder</code>) are meant to be mutated inside middleware. All other fields are for reading or inspection.</p></div><h3 id="working-with-builders" tabindex="-1"><a class="header-anchor" href="#working-with-builders"><span>Working with Builders</span></a></h3><p>Each builder offers two methods:</p><ul><li><code>add(key, value)</code>: Adds a key-value pair to the builder.</li><li><code>addIf(key, value)</code>: Adds value only if the key is not already present.</li></ul><h4 id="input-builder-incomingeventbuilder" tabindex="-1"><a class="header-anchor" href="#input-builder-incomingeventbuilder"><span>Input Builder: <code>incomingEventBuilder</code></span></a></h4><p>Transforms the external platform request into a normalized <code>IncomingEvent</code>.</p><p>Example:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line">context<span class="token punctuation">.</span>incomingEventBuilder</span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#39;headers&#39;</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>rawEvent<span class="token punctuation">.</span>headers<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">addIf</span><span class="token punctuation">(</span><span class="token string">&#39;method&#39;</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>rawEvent<span class="token punctuation">.</span>method<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="output-builder-rawresponsebuilder" tabindex="-1"><a class="header-anchor" href="#output-builder-rawresponsebuilder"><span>Output Builder: <code>rawResponseBuilder</code></span></a></h4><p>Converts the <code>OutgoingResponse</code> back to the platform-native format, using <code>context.outgoingResponse</code> after the handler has executed.</p><p>You gain access to both the <code>incomingEvent</code> and <code>outgoingResponse</code> <strong>after</strong> calling <code>next()</code>:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">const</span> rawResponseBuilder <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">rawResponseBuilder</span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#39;headers&#39;</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>outgoingResponse<span class="token punctuation">.</span>headers<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#39;statusCode&#39;</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>outgoingResponse<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> rawResponseBuilder</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>For adapter-specific details about the context structure and available builder options, refer to the README of the corresponding adapter package on npm or GitHub.</p></div><h3 id="defining-middleware" tabindex="-1"><a class="header-anchor" href="#defining-middleware"><span>Defining Middleware</span></a></h3><p>Adapter middleware can be defined either <strong>declaratively</strong> using decorators, or <strong>imperatively</strong> using factory functions. Both approaches allow you to inject logic into the building of <code>IncomingEvent</code> before your system logic executes, and to shape the <code>rawResponse</code> before it is sent back to the platform.</p>`,32)),i(p,{data:[{id:"Declarative"},{id:"Imperative"}],active:0,"tab-id":"declarative-imperative"},{title0:a(({value:t,isActive:o})=>e[16]||(e[16]=[s("Declarative")])),title1:a(({value:t,isActive:o})=>e[17]||(e[17]=[s("Imperative")])),tab0:a(({value:t,isActive:o})=>e[18]||(e[18]=[n("h4",{id:"declarative-middleware",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#declarative-middleware"},[n("span",null,"Declarative Middleware")])],-1),n("p",null,[s("The simplest way to define adapter middleware is through a class decorated with "),n("code",null,"@AdapterMiddleware()"),s(".")],-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  AdapterMiddleware"),n("span",{class:"token punctuation"},","),s(" NextMiddleware"),n("span",{class:"token punctuation"},","),s(" IBlueprint")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/core'")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  NodeHttpAdapterContext"),n("span",{class:"token punctuation"},","),s(" NodeHttpAdapterResponseBuilder")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/node-http-adapter'")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"AdapterMiddleware")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"MyAdapterMiddleware"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"readonly"),s(" blueprint"),n("span",{class:"token operator"},":"),s(" IBlueprint")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token function"},"constructor"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" blueprint "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(" blueprint"),n("span",{class:"token operator"},":"),s(" IBlueprint "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("blueprint "),n("span",{class:"token operator"},"="),s(" blueprint")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token function"},"handle"),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("    context"),n("span",{class:"token operator"},":"),s(" NodeHttpAdapterContext"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    next"),n("span",{class:"token operator"},":"),s(" NextMiddleware"),n("span",{class:"token operator"},"<"),s("NodeHttpAdapterContext"),n("span",{class:"token punctuation"},","),s(" NodeHttpAdapterResponseBuilder"),n("span",{class:"token operator"},">")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"Promise"),n("span",{class:"token operator"},"<"),s("NodeHttpAdapterResponseBuilder"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    context"),n("span",{class:"token punctuation"},"."),s("incomingEventBuilder")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'headers'"),n("span",{class:"token punctuation"},","),s(" context"),n("span",{class:"token punctuation"},"."),s("rawEvent"),n("span",{class:"token punctuation"},"."),s("headers"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'metadata'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("blueprint"),n("span",{class:"token punctuation"},"."),s("metadata"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,[s("This middleware will apply to "),n("strong",null,"all adapters"),s(", unless explicitly scoped.")],-1)])),tab1:a(({value:t,isActive:o})=>e[19]||(e[19]=[n("h4",{id:"imperative-middleware",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#imperative-middleware"},[n("span",null,"Imperative Middleware")])],-1),n("p",null,"You can also define middleware as a factory function and register it manually during blueprint setup:",-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" NextMiddleware"),n("span",{class:"token punctuation"},","),s(" IBlueprint "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/core'")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  NodeHttpAdapterContext"),n("span",{class:"token punctuation"},","),s(" NodeHttpAdapterResponseBuilder")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/node-http-adapter'")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"MyAdapterMiddleware"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" blueprint "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(" blueprint"),n("span",{class:"token operator"},":"),s(" IBlueprint "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("    context"),n("span",{class:"token operator"},":"),s(" NodeHttpAdapterContext"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    next"),n("span",{class:"token operator"},":"),s(" NextMiddleware"),n("span",{class:"token operator"},"<"),s("NodeHttpAdapterContext"),n("span",{class:"token punctuation"},","),s(" NodeHttpAdapterResponseBuilder"),n("span",{class:"token operator"},">")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"Promise"),n("span",{class:"token operator"},"<"),s("NodeHttpAdapterResponseBuilder"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    context"),n("span",{class:"token punctuation"},"."),s("incomingEventBuilder")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'metadata'"),n("span",{class:"token punctuation"},","),s(" blueprint"),n("span",{class:"token punctuation"},"."),s("metadata"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'headers'"),n("span",{class:"token punctuation"},","),s(" context"),n("span",{class:"token punctuation"},"."),s("rawEvent"),n("span",{class:"token punctuation"},"."),s("headers"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,"To register this middleware, use a setup middleware:",-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" defineBlueprintConfig "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/core'")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"MySetupMiddleware"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token punctuation"},","),s(" next"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"const"),s(" blueprint "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("  blueprint"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'stone.adapter.middleware'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"[")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{"),s(" module"),n("span",{class:"token operator"},":"),s(" MyAdapterMiddleware"),n("span",{class:"token punctuation"},","),s(" isFactory"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),s(),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"return"),s(" blueprint")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(" appBlueprint "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"defineBlueprintConfig"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("blueprint"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  blueprint"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'stone.blueprint.middleware'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"["),s("MySetupMiddleware"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1)])),_:1}),e[35]||(e[35]=n("div",{class:"hint-container important"},[n("p",{class:"hint-container-title"},"Important"),n("p",null,"At the time adapter middleware is constructed, whether as a class or factory, only the blueprint is available, as the Stone.js container has not yet been initialized.")],-1)),e[36]||(e[36]=n("h3",{id:"scoping-middleware",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#scoping-middleware"},[n("span",null,"Scoping Middleware")])],-1)),e[37]||(e[37]=n("p",null,"When your system uses multiple adapters, it's important to scope each middleware to the adapter it is intended for. This avoids accidental misbehavior across platforms.",-1)),i(p,{data:[{id:"Declarative"},{id:"Imperative"}],active:0,"tab-id":"declarative-imperative"},{title0:a(({value:t,isActive:o})=>e[20]||(e[20]=[s("Declarative")])),title1:a(({value:t,isActive:o})=>e[21]||(e[21]=[s("Imperative")])),tab0:a(({value:t,isActive:o})=>e[22]||(e[22]=[n("h4",{id:"declarative-scoping",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#declarative-scoping"},[n("span",null,"Declarative Scoping")])],-1),n("p",null,"You can scope middleware by using one of the following options in the decorator:",-1),n("ul",null,[n("li",null,[n("code",null,"platform"),s(": a string identifier for the adapter's platform (e.g., "),n("code",null,"'node_http'"),s(", "),n("code",null,"'browser'"),s(")")]),n("li",null,[n("code",null,"adapterAlias"),s(": the alias assigned to the adapter when it was registered")])],-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"AdapterMiddleware")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" platform"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'node_http'"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"NodeOnlyMiddleware"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token comment"},"/* ... */"),s(),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"AdapterMiddleware")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" adapterAlias"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'MyBrowserAdapter'"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"BrowserOnlyMiddleware"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token comment"},"/* ... */"),s(),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1)])),tab1:a(({value:t,isActive:o})=>e[23]||(e[23]=[n("h4",{id:"imperative-scoping",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#imperative-scoping"},[n("span",null,"Imperative Scoping")])],-1),n("p",null,"You can also perform manual checks during blueprint setup and conditionally add the middleware:",-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"MySetupMiddleware"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token punctuation"},","),s(" next"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"const"),s(" blueprint "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("blueprint"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'stone.adapter.platform'"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},"'browser'"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    blueprint"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'stone.adapter.middleware'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"[")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token punctuation"},"{"),s(" module"),n("span",{class:"token operator"},":"),s(" MyAdapterMiddleware"),n("span",{class:"token punctuation"},","),s(" isFactory"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),s(),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"return"),s(" blueprint")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,"This approach offers complete flexibility, especially useful when adapter selection depends on runtime context.",-1)])),_:1}),e[38]||(e[38]=l('<h3 id="notes" tabindex="-1"><a class="header-anchor" href="#notes"><span>Notes</span></a></h3><ul><li>To see what fields are available for <code>incomingEventBuilder</code>, refer to the <a href="../essentials/incoming-event"><strong>Incoming Event</strong></a> documentation.</li><li>To understand what values are accessible from <code>OutgoingResponse</code>, check the <a href="../essentials/outgoing-response"><strong>Outgoing Response</strong></a> documentation.</li></ul><h2 id="integration-hooks" tabindex="-1"><a class="header-anchor" href="#integration-hooks"><span>Integration Hooks</span></a></h2><p>Integration hooks in Stone.js allow you to observe and react to the platform-specific phases of your system, including adapter startup, event transformation, middleware execution, and shutdown.</p>',4)),i(c,{id:"mermaid-889",code:"eJyV0jtvwjAQB/CdT3EKygYSULowVOIRXmqlCqouUQcTX4pVY6e2aaCI717HDgKpQ10WlPv/7s55xPGJCWYGcIrMFncYDSDaEI1RC3zhlShGNhy1TU4NgCiXwqzZt5PdfnGIWlWVM4FjyaWqyk16d9/vdKLG+XyO40bOZZltiTLwMrEWYJiuj9rgDrSx1Tdotx9glEqxdpee+GL3KmXhk1HXRz3XcKl6P06Tg0ElCAeFn3vU9bSxSye2Y7RnnDLxvhCZ3Nn/5AtFjSYOJemzkhlqbUN4YpRyLIlCeJTVKgcTB6d22pUOKSns5muDnzl1dGaPhdne4M1An89cPrejfg2oZyOtt87/d7zFzc2uSLlCXUih67WeLC2ZE0Htu7ucP1FKKjsnjmFtjlUAuVRAOAchKWrXrW2C9olro+QHtktGzXZgv4RWzjgfNKfudyNH4bIbTnvBdBwsJ8EyCZbTYDkLlvNguQiWyz/kD8NvTLc="}),e[39]||(e[39]=l(`<p>These hooks belong to the <strong>Integration Dimension</strong> of the Continuum Architecture. They do not affect your application logic directly, but instead provide a clean mechanism to tap into low-level system behavior. They&#39;re useful for logging, metrics, debugging, diagnostics, and graceful shutdowns, all without polluting your core system logic.</p><p>There are two types of integration hooks:</p><ul><li><strong>Global hooks</strong>, triggered during lifecycle events like startup or shutdown.</li><li><strong>Per-intention hooks</strong>, triggered during adapter-level processing, such as when building events, running middleware, or handling adapter-level errors.</li></ul><h3 id="available-integration-hooks" tabindex="-1"><a class="header-anchor" href="#available-integration-hooks"><span>Available Integration Hooks</span></a></h3><p>Here’s a list of all built-in integration hooks available in Stone.js:</p><table><thead><tr><th>Hook Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>onStart</code></td><td>Global</td><td>Called once when the system starts</td></tr><tr><td><code>onStop</code></td><td>Global</td><td>Called once when the system shuts down</td></tr><tr><td><code>onProcessingAdapterMiddleware</code></td><td>Per-intention</td><td>Triggered before each adapter middleware is executed</td></tr><tr><td><code>onAdapterMiddlewareProcessed</code></td><td>Per-intention</td><td>Triggered after all adapter middleware have executed</td></tr><tr><td><code>onBuildingIncomingEvent</code></td><td>Per-intention</td><td>Triggered while building the <code>IncomingEvent</code></td></tr><tr><td><code>onBuildingRawResponse</code></td><td>Per-intention</td><td>Triggered while building the final platform-native response</td></tr><tr><td><code>onHandlingAdapterError</code></td><td>Per-intention</td><td>Triggered if an error occurs during adapter processing (e.g., event build)</td></tr></tbody></table><p>These hooks help you instrument the edges of your system without coupling to specific adapters or transports.</p><h3 id="hook-contexts" tabindex="-1"><a class="header-anchor" href="#hook-contexts"><span>Hook Contexts</span></a></h3><p>Each hook receives a context object that gives it visibility into the system’s current state.</p><h4 id="adapter-hook-context" tabindex="-1"><a class="header-anchor" href="#adapter-hook-context"><span>Adapter Hook Context</span></a></h4><p>This is the context used for hooks like <code>onStart</code>, <code>onStop</code>, <code>onBuildingRawResponse</code>, <code>onBuildingIncomingEvent</code>, and <code>onHandlingAdapterError</code>.</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">AdapterHookListenerContext</span> <span class="token punctuation">{</span></span>
<span class="line">  error<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span></span>
<span class="line">  blueprint<span class="token operator">:</span> IBlueprint</span>
<span class="line">  context<span class="token operator">?</span><span class="token operator">:</span> AdapterContext</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong><code>blueprint</code></strong> – The current blueprint object (always present)</li><li><strong><code>context</code></strong> – Optional. Contains adapter-specific details (see below)</li><li><strong><code>error</code></strong> – Present only in failure hooks like <code>onHandlingAdapterError</code></li></ul><p>The <code>context</code> property refers to the adapter context:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">AdapterContext</span> <span class="token punctuation">{</span></span>
<span class="line">  rawEvent<span class="token operator">:</span> RawEventType</span>
<span class="line">  rawResponse<span class="token operator">?</span><span class="token operator">:</span> RawResponseType</span>
<span class="line">  executionContext<span class="token operator">:</span> ExecutionContextType</span>
<span class="line">  incomingEvent<span class="token operator">?</span><span class="token operator">:</span> IncomingEventType</span>
<span class="line">  outgoingResponse<span class="token operator">?</span><span class="token operator">:</span> OutgoingResponseType</span>
<span class="line">  incomingEventBuilder<span class="token operator">:</span> IAdapterEventBuilder</span>
<span class="line">  rawResponseBuilder<span class="token operator">:</span> IAdapterEventBuilder</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>For more on adapter context and builders, refer to the <a href="#adapter-middleware"><strong>Adapter Middleware</strong></a> section.</p><h4 id="middleware-hook-context" tabindex="-1"><a class="header-anchor" href="#middleware-hook-context"><span>Middleware Hook Context</span></a></h4><p>Used specifically by middleware-related hooks like <code>onProcessingAdapterMiddleware</code>.</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">MiddlewareHookContext</span> <span class="token punctuation">{</span></span>
<span class="line">  passable<span class="token operator">:</span> AdapterContext</span>
<span class="line">  pipe<span class="token operator">:</span> PipeCustomInstance</span>
<span class="line">  instance<span class="token operator">:</span> PipeCustomInstance</span>
<span class="line">  pipes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>MetaPipe<span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong><code>passable</code></strong> – The current adapter context (same as above)</li><li><strong><code>pipe</code></strong> – The current middleware being executed</li><li><strong><code>instance</code></strong> – The resolved instance of the middleware (class or function)</li><li><strong><code>pipes</code></strong> – The full list of middleware for the adapter</li></ul><p>These fields let you trace which middleware is running and access the current context being passed through the pipeline.</p><h3 id="registering-integration-hooks" tabindex="-1"><a class="header-anchor" href="#registering-integration-hooks"><span>Registering Integration Hooks</span></a></h3><p>Hooks can be registered using either the <strong>declarative</strong> or <strong>imperative</strong> API.</p>`,23)),i(p,{data:[{id:"Declarative"},{id:"Imperative"}],active:0,"tab-id":"declarative-imperative"},{title0:a(({value:t,isActive:o})=>e[24]||(e[24]=[s("Declarative")])),title1:a(({value:t,isActive:o})=>e[25]||(e[25]=[s("Imperative")])),tab0:a(({value:t,isActive:o})=>e[26]||(e[26]=[n("h4",{id:"declarative-hook-registration",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#declarative-hook-registration"},[n("span",null,"Declarative Hook Registration")])],-1),n("p",null,[s("Use the "),n("code",null,"@Hook('<hookName>')"),s(" method decorator to register a hook. Hook methods can live in any class, but for clarity and separation of concerns, it's best to place them in a dedicated observer class or service provider.")],-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  Hook"),n("span",{class:"token punctuation"},","),s(" MiddlewareHookContext"),n("span",{class:"token punctuation"},","),s(" AdapterHookListenerContext")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/core'")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"AdapterObserver"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"Hook")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'onStart'"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token function"},"onStarting"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token builtin"},"console"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'Starting up...'"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"Hook")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'onBuildingIncomingEvent'"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token function"},"buildingEvent"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" context "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token operator"},":"),s(" AdapterHookListenerContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token builtin"},"console"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'Building event from'"),n("span",{class:"token punctuation"},","),s(" context"),n("span",{class:"token operator"},"?."),s("rawEvent"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token decorator"},[n("span",{class:"token at operator"},"@"),n("span",{class:"token function"},"Hook")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'onProcessingAdapterMiddleware'"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token function"},"logMiddleware"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" pipe "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token operator"},":"),s(" MiddlewareHookContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token builtin"},"console"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"Running adapter middleware: "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("pipe"),n("span",{class:"token punctuation"},"."),s("module"),n("span",{class:"token punctuation"},"."),s("name"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,"Hooks are automatically registered and matched based on their names. All parameters are injected automatically.",-1),n("p",null,[s("Hook methods are executed via reflection. They are "),n("strong",null,"not"),s(" tied to class lifecycle, avoid using "),n("code",null,"this"),s(".")],-1)])),tab1:a(({value:t,isActive:o})=>e[27]||(e[27]=[n("h4",{id:"imperative-hook-registration",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#imperative-hook-registration"},[n("span",null,"Imperative Hook Registration")])],-1),n("p",null,"For more dynamic scenarios, you can register integration hooks programmatically via the blueprint:",-1),n("div",{class:"language-typescript line-numbers-mode","data-highlighter":"prismjs","data-ext":"ts"},[n("pre",null,[n("code",{class:"language-typescript"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  defineBlueprintConfig"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  MiddlewareHookContext"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},"  AdapterHookListenerContext"),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@stone-js/core'")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"onStarting"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token builtin"},"console"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'System is starting...'"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"buildingEvent"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" context "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token operator"},":"),s(" AdapterHookListenerContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token builtin"},"console"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'Transforming raw input into IncomingEvent:'"),n("span",{class:"token punctuation"},","),s(" context"),n("span",{class:"token operator"},"?."),s("rawEvent"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"logMiddleware"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" pipe "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token operator"},":"),s(" MiddlewareHookContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token builtin"},"console"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"Executing middleware: "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("pipe"),n("span",{class:"token punctuation"},"."),s("module"),n("span",{class:"token punctuation"},"."),s("name"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(" appSetupBlueprint "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"defineBlueprintConfig"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("blueprint"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},"  blueprint"),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'stone.lifecycleHooks.onStart'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"["),s("onStarting"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'stone.lifecycleHooks.onBuildingIncomingEvent'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"["),s("buildingEvent"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'stone.lifecycleHooks.onProcessingAdapterMiddleware'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"["),s("logMiddleware"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,[s("The hook names follow the namespace format: "),n("code",null,"stone.lifecycleHooks.<hookName>"),s(". You can add multiple functions per hook.")],-1)])),_:1}),e[40]||(e[40]=l(`<h2 id="best-practices" tabindex="-1"><a class="header-anchor" href="#best-practices"><span>Best Practices</span></a></h2><p>Using adapters effectively in Stone.js means understanding the execution context while keeping your system logic pure and portable. Here are the recommended patterns to follow when working with adapters and their supporting features.</p><h4 id="don-t-mutate-events-directly-use-builders" tabindex="-1"><a class="header-anchor" href="#don-t-mutate-events-directly-use-builders"><span>Don’t Mutate Events Directly, Use Builders</span></a></h4><p>Inside adapter middleware, always use <code>incomingEventBuilder</code> and <code>rawResponseBuilder</code>:</p><p>✅ Good:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line">context<span class="token punctuation">.</span>incomingEventBuilder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#39;headers&#39;</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>rawEvent<span class="token punctuation">.</span>headers<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>🚫 Bad:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line">context<span class="token punctuation">.</span>incomingEvent <span class="token operator">=</span> <span class="token operator">...</span> <span class="token comment">// Never do this</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>These builders ensure events are correctly constructed and introspected by the system. And any mutation will be overwritten when the event is built.</p><h4 id="scope-middleware-when-using-multiple-adapters" tabindex="-1"><a class="header-anchor" href="#scope-middleware-when-using-multiple-adapters"><span>Scope Middleware When Using Multiple Adapters</span></a></h4><p>Adapter contexts are platform-specific. If you&#39;re using more than one adapter, <strong>always scope your middleware</strong>:</p><ul><li>Declaratively with <code>@AdapterMiddleware({ platform: &#39;node_http&#39; })</code></li><li>Imperatively by checking <code>stone.adapter.platform</code> or <code>stone.adapter.alias</code></li></ul><p>This prevents a mismatch between middleware logic and the runtime context.</p><h4 id="keep-adapter-middleware-focused" tabindex="-1"><a class="header-anchor" href="#keep-adapter-middleware-focused"><span>Keep Adapter Middleware Focused</span></a></h4><p>Adapter middleware should do exactly one thing: <strong>build normalized data</strong>.</p><p>Avoid:</p><ul><li>Business logic</li><li>Database access</li></ul><p>Instead:</p><ul><li>Extract headers, metadata, user agent, request ID, etc.</li><li>Format them cleanly for use inside the <code>IncomingEvent</code> or <code>rawResponse</code></li></ul><h4 id="use-integration-hooks-for-observability" tabindex="-1"><a class="header-anchor" href="#use-integration-hooks-for-observability"><span>Use Integration Hooks for Observability</span></a></h4><p>Want to track startup, middleware flow, or raw events?</p><p>Use hooks like <code>onStart</code>, <code>onBuildingIncomingEvent</code>, or <code>onProcessingAdapterMiddleware</code> to monitor the system from the edge.</p><p>Hooks are the right place for:</p><ul><li>Logging</li><li>Tracing</li><li>Lifecycle alerts</li><li>External monitoring</li></ul><p>They let you <strong>observe without interfering</strong>.</p><div class="hint-container important"><p class="hint-container-title">Important</p><p>Keep your adapter layer <strong>thin and testable</strong>.</p></div><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><p>Adapters are the entry point of every Stone.js application. They translate platform-specific inputs into standardized <code>IncomingEvent</code> objects and convert your system&#39;s <code>OutgoingResponse</code> into native output, no matter where your app runs.</p><p>Stone.js offers built-in adapters for:</p><ul><li>Node.js (HTTP, CLI)</li><li>AWS Lambda (event or HTTP)</li><li>Browser (SPA, SSR)</li></ul><p>You can register adapters <strong>declaratively</strong> using decorators or <strong>imperatively</strong> using blueprints, giving you flexibility based on the level of control you need.</p><p>Adapter middleware lets you participate in the construction of events and responses, using builder objects instead of direct mutation. Scoped middleware ensures clean multi-platform behavior.</p><p>Integration hooks provide a powerful observability layer. Whether you want to log startup, trace middleware execution, or debug event transformations, hooks give you visibility, without coupling to your app logic.</p><p>Adapters live in the <strong>Integration Dimension</strong> of the Continuum Architecture. They form the boundary between the external world and your internal logic. You don’t have to think in platforms, just intentions.</p>`,34))])}const y=d(m,[["render",h]]),f=JSON.parse('{"path":"/docs/architecture/adapter.html","title":"Adapter","lang":"en-US","frontmatter":{"title":"Adapter","description":"Adapters in Stone.js are the official bridge between your application and the outside world. Whether you’re running in a Node.js server, a FaaS like AWS Lambda, a browser, or a ...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Adapter\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-06-07T20:31:21.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr. Stone\\"}]}"],["meta",{"property":"og:url","content":"https://stonejs.com/docs/architecture/adapter.html"}],["meta",{"property":"og:site_name","content":"Stone.js"}],["meta",{"property":"og:title","content":"Adapter"}],["meta",{"property":"og:description","content":"Adapters in Stone.js are the official bridge between your application and the outside world. Whether you’re running in a Node.js server, a FaaS like AWS Lambda, a browser, or a ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-06-07T20:31:21.000Z"}],["meta",{"property":"article:modified_time","content":"2025-06-07T20:31:21.000Z"}]]},"git":{"createdTime":1749328281000,"updatedTime":1749328281000,"contributors":[{"name":"Mr Stone","username":"","email":"pierre.evens16@gmail.com","commits":1}]},"readingTime":{"minutes":12.56,"words":3767},"filePathRelative":"docs/architecture/adapter.md","autoDesc":true}');export{y as comp,f as data};
